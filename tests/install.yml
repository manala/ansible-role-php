---

- name: Install - Wheezy - Php 5.4
  hosts: wheezy
  vars:
    manala_php_version: 5
    manala_php_sapis:
      - cli
  pre_tasks:
    - include: pre_tasks/dotdeb_wheezy.yml
  roles:
    - manala.php
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            php5-common:
              installed: true
            php5-cli:
              installed: true
        - command:
            php --version:
              exit-status: 0
              stdout:
                - PHP 5.4.

- name: Install - Wheezy - Php 5.5
  hosts: wheezy
  vars:
    manala_php_version: 5
    manala_php_sapis:
      - cli
  pre_tasks:
    - include: pre_tasks/dotdeb_wheezy_55.yml
  roles:
    - manala.php
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            php5-common:
              installed: true
            php5-cli:
              installed: true
        - command:
            php --version:
              exit-status: 0
              stdout:
                - PHP 5.5.

- name: Install - Wheezy - Php 5.6
  hosts: wheezy
  vars:
    manala_php_version: 5
    manala_php_sapis:
      - cli
  pre_tasks:
    - include: pre_tasks/dotdeb_wheezy_56.yml
  roles:
    - manala.php
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            php5-common:
              installed: true
            php5-cli:
              installed: true
        - command:
            php --version:
              exit-status: 0
              stdout:
                - PHP 5.6.

- name: Install - Jessie - 7.0
  hosts: jessie
  vars:
    manala_php_version: 7.0
    manala_php_sapis:
      - cli
  pre_tasks:
    - include: pre_tasks/dotdeb_jessie.yml
  roles:
    - manala.php
  post_tasks:
    - raw: "{{ 'echo \"' ~ item|to_yaml ~ '\"|goss -g - validate' }}"
      with_items:
        - package:
            php7.0-common:
              installed: true
            php7.0-cli:
              installed: true
            php7.0-json:
              installed: true
            php7.0-opcache:
              installed: true
            php7.0-readline:
              installed: true
        - command:
            php --version:
              exit-status: 0
              stdout:
                - PHP 7.0.
